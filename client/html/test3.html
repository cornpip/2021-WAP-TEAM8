<body>
    <div id="log"></div>
    <div id="sendControlls">
      <input type="text" placeholder="message" id="text"/>
      <button>send</button>
    </div>
  
    <script>
      const sock = new WebSocket("ws://localhost:8001");
      const log = document.getElementById("log");
      //웹 접근시  창에서 닉네임 입력
      //const name = prompt("your name");
  // 소켓 최초 접근시 오픈해서 입력한 닉네임을 서버로 보냄
      sock.onopen=()=>{
        sock.send(JSON.stringify({
          type:"name",
          data:name
        }))
      }
  // 1.보내면
      document.querySelector("button").onclick = ()=>{
        const text = document.getElementById("text").value;
        // sock.send(text);
        sock.send(JSON.stringify({
          type:"message",
          data:text
        }));  
        log.innerHTML+="<p class='my'>you: "+text+"</p>";
      }
  // 서버에서 보낸거 받기
      sock.onmessage= e=>{
        console.log(e);
        const json = JSON.parse(e.data);
        // useReducer가 action에 따라 상태 구분하듯 type에 따라
        if(json.type==="newPeople"){
          // 새로운 사람 입장시
          if(!json.newChater)return
          log.innerHTML+="<p>"+json.newChater+"님이 입장했습니다.</p>";
          return
        }
        if(json.type==="bye"){
          // 누군가 나갈시
          log.innerHTML+="<p>"+json.name+"님이 퇴장하셨습니다.</p>";
          return
        }
        // 메시지 보낼시
        log.innerHTML+="<p>"+json.name+":"+json.data+"</p>";
      }
      console.log(sock)
    </script>
   </body>